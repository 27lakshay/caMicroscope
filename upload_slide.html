<html>
Filename : <input type="text" id="filename"><br/>
<input type="file" id="input" onchange="handle_upload(this.files)">
<script>
function parseFile(file, callback) {
    var fileSize   = file.size;
    var chunkSize  = 64 * 1024; // bytes
    var offset     = 0;
    var self       = this; // we need a reference to the current object
    var chunkReaderBlock = null;

    var readEventHandler = function(evt) {
        if (evt.target.error == null) {
            offset += evt.target.result.length;
            callback({chunkSize:chunkSize, offset:offset, data:btoa(evt.target.result)}); // callback for handling read chunk
        } else {
            console.log("Read error: " + evt.target.error);
            return;
        }
        if (offset >= fileSize) {
            console.log("Done reading file");
            return;
        }

        // of to the next chunk
        chunkReaderBlock(offset, chunkSize, file);
    }

    chunkReaderBlock = function(_offset, length, _file) {
        var r = new FileReader();
        var blob = _file.slice(_offset, length + _offset);
        r.onload = readEventHandler;
        r.readAsBinaryString(blob);
    }

    // now let's start the read with the first block
    chunkReaderBlock(offset, chunkSize, file);
}

function handle_upload(selectedFiles){
  selectedFile = selectedFiles[0]
  console.log(document.getElementById("filename").value)
  parseFile(selectedFile, console.log)
}
</script>
</html>
