parcelRequire=function(e,r,n,t){var i="function"==typeof parcelRequire&&parcelRequire,o="function"==typeof require&&require;function u(n,t){if(!r[n]){if(!e[n]){var f="function"==typeof parcelRequire&&parcelRequire;if(!t&&f)return f(n,!0);if(i)return i(n,!0);if(o&&"string"==typeof n)return o(n);var c=new Error("Cannot find module '"+n+"'");throw c.code="MODULE_NOT_FOUND",c}p.resolve=function(r){return e[n][1][r]||r};var l=r[n]=new u.Module(n);e[n][0].call(l.exports,p,l,l.exports,this)}return r[n].exports;function p(e){return u(p.resolve(e))}}u.isParcelRequire=!0,u.Module=function(e){this.id=e,this.bundle=u,this.exports={}},u.modules=e,u.cache=r,u.parent=i,u.register=function(r,n){e[r]=[function(e,r){r.exports=n},{}]};for(var f=0;f<n.length;f++)u(n[f]);if(n.length){var c=u(n[n.length-1]);"object"==typeof exports&&"undefined"!=typeof module?module.exports=c:"function"==typeof define&&define.amd?define(function(){return c}):t&&(this[t]=c)}return u}({"FfXV":[function(require,module,exports) {
"use strict";Object.defineProperty(exports,"__esModule",{value:!0});var e=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}();function t(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}var r=function(){function r(e,i,s,o,a){t(this,r),this.viewer=a,this.project=e,this.location=i,this.dataset=s,this.store=o,this.COLUMN_POSITION_TAG="0048021E",this.COLUMNS_TAG="00280011",this.FUNCTIONAL_GROUP_SEQUENCE_TAG="52009230",this.PLANE_POSITION_SEQUENCE_TAG="0048021A",this.ROW_POSITION_TAG="0048021F",this.ROWS_TAG="00280010",this.SERIES_INSTANCE_UID_TAG="0020000E",this.SOP_INSTANCE_UID_TAG="00080018",this.STUDY_INSTANCE_UID_TAG="0020000D",this.TOTAL_PIXEL_MATRIX_COLUMNS_TAG="00480006",this.TOTAL_PIXEL_MATRIX_ROWS_TAG="00480007",this.updatedDicomUrl="https://healthcare.googleapis.com/v1beta1/projects/";var n=RegExp("GHCToken[^;]+").exec(document.cookie);this.token=decodeURIComponent(n?n.toString().replace(/^[^=]+./,""):"")}return e(r,[{key:"toDicomWebQIDOUrl",value:function(e){return this.updatedDicomUrl+e+"?includefield=all&access_token="+this.token}},{key:"toDicomWebWADOUrl",value:function(e){return this.updatedDicomUrl+e+"?access_token="+this.token}},{key:"loadInstancesInStudy",value:function(e){var t=this.project+"/locations/"+this.location+"/datasets/"+this.dataset+"/dicomStores/"+this.store+"/dicomWeb/studies/"+e+"/series";$.ajax({url:this.toDicomWebQIDOUrl(t),error:function(e){alert("Error - retrieving series failed: "+e.responseJSON[0].error.code+" "+e.responseJSON[0].error.message)},success:function(e){var r=t+"/"+e[0][this.SERIES_INSTANCE_UID_TAG].Value[0]+"/instances";$.ajax({url:this.toDicomWebQIDOUrl(r),error:function(e){alert("Error - retrieving instances failed: "+e.responseJSON[0].error.code+" "+e.responseJSON[0].error.message)},success:function(e){try{for(var t=0,i=0,s=0,o=0,a=new Set,n=0;n<e.length;n++){var l=Number(e[n][this.TOTAL_PIXEL_MATRIX_COLUMNS_TAG].Value);a.add(l);var c=Number(e[n][this.TOTAL_PIXEL_MATRIX_ROWS_TAG].Value);l>t&&(t=l),c>i&&(i=c),s=Number(e[n][this.COLUMNS_TAG].Value),o=Number(e[n][this.ROWS_TAG].Value)}var u=Array.from(a.values());u.sort(function(e,t){return t-e});var _=a.size,h=this.calculatePyramidMeta(e,u),T={height:i,width:t,tileSize:s,maxLevel:_-1,minLevel:0,getTileUrl:function(e,t,i){var a=h[1+s*t+"/"+(1+o*i)+"/"+(_-1-e)];return this.toDicomWebWADOUrl(r+"/"+a.SOPInstanceUID+"/frames/"+a.FrameNumber+"/rendered")}.bind(this),getLevelScale:function(e){return u[_-1-e]/t}},O=new CustomEvent("ghc_tileSource_ready",{detail:T});document.dispatchEvent(O),console.log(T),this.viewer.open(T)}catch(e){console.error(e),alert("Could not parse DICOM for study, possible reason: DICOM is not\n                   pathology or damaged image.")}}.bind(this)})}.bind(this)})}},{key:"calculatePyramidMeta",value:function(e,t){for(var r={},i=0;i<t.length;i++)r[t[i]]=i;for(var s={},o=0;o<e.length;o++)for(var a=e[o][this.SOP_INSTANCE_UID_TAG].Value,n=e[o][this.FUNCTIONAL_GROUP_SEQUENCE_TAG].Value,l=0;l<n.length;l++){var c=l+1,u=n[l][this.PLANE_POSITION_SEQUENCE_TAG].Value[0][this.COLUMN_POSITION_TAG].Value,_=n[l][this.PLANE_POSITION_SEQUENCE_TAG].Value[0][this.ROW_POSITION_TAG].Value,h=Number(e[o][this.TOTAL_PIXEL_MATRIX_COLUMNS_TAG].Value);s[u+"/"+_+"/"+t.indexOf(h)]={SOPInstanceUID:a,FrameNumber:c}}return s}}]),r}();exports.default=r;
},{}],"8RL4":[function(require,module,exports) {
"use strict";var t=require("./GHCHelpers.js"),e=s(t);function s(t){return t&&t.__esModule?t:{default:t}}CaMic.prototype.loadImg=function(t){var s=this,i=new URLSearchParams(window.location.search),a={};try{a=JSON.parse(decodeURIComponent(i.get("slideId")))||{}}catch(t){console.log("bad or missing ghc param object",t)}this.project=a.project||"public-datasets-194701",this.location=a.location||"us-central1",this.data_store=a.datastore||"test1",this.dataset=a.dataset||"rbirmin_dicom_test",this.ghc_study=a.study||"1.2.276.0.7230010.3.1.2.1784940379.231387.1533066220.970617";i.get("slideId");this.slideId="GHC:"+this.project+":"+this.location+":"+this.data_store+":"+this.dataset+":"+this.ghc_study,this.slideName="GHC IMG FROM "+this.project,this.study="",this.specimen="",this.mpp=1e9,this.mpp_x=this.mpp,this.mpp_y=this.mpp;var o=new e.default(this.project,this.location,this.dataset,this.data_store,this.viewer);document.addEventListener("ghc_tileSource_ready",function(e){console.log("finishing load with event");var i={};i._id=s.slideId,i.name=s.slideName,i.study=s.study,i.specimen=s.specimen,i.mpp=s.mpp,i.mpp_x=s.mpp_x,i.mpp_y=s.mpp_y,i.location="GHC--"+s.slideId,i.url=e.tileSource,t&&"function"==typeof t&&t.call(null,i)}),o.loadInstancesInStudy(this.ghc_study)};
},{"./GHCHelpers.js":"FfXV"}]},{},["8RL4"], null)
//# sourceMappingURL=/ghc_package.map