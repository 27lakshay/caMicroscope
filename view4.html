<!DOCTYPE html>
<html lang="en">

 <head>
  <meta charset="utf-8" />
  <meta name="author" content="Ruven Pillay &lt;ruven@users.sourceforge.netm&gt;"/>
  <meta name="keywords" content="IIPImage HTML5 Ajax Internet Imaging IIP Zooming Streaming High Resolution Mootools"/>
  <meta name="description" content="IIPImage: High Resolution HTML5 Ajax Image Streaming Viewer"/>
  <meta name="copyright" content="&copy; 2003-2011 Ruven Pillay"/>
  <meta name="viewport" content="width=device-width; initial-scale=1.0; maximum-scale=1.0; user-scalable=0;" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent" />
  <meta http-equiv="X-UA-Compatible" content="IE=9" >

  <link rel="stylesheet" type="text/css" media="all" href="css/iip.css" />
  <link rel="stylesheet" type="text/css" media="all" href="css/annot.css" />
<!--[if lt IE 9]>
  <link rel="stylesheet" type="text/css" media="all" href="css/ie.css" />
<![endif]-->

  <link rel="shortcut icon" href="images/iip-favicon.png" />

  <title>IIPMooViewer 2.0 :: IIPImage High Resolution HTML5 Ajax Image Streaming Viewer</title>

  <script type="text/javascript" src="js/mootools-core-1.3.2-full-nocompat.js"></script>
  <script type="text/javascript" src="js/mootools-more-1.3.2.1.js"></script>
  <script type="text/javascript" src="js/protocols.js"></script>
  <script type="text/javascript" src="js/iipmooviewer-2.0.4.js"></script>
  <script type="text/javascript" src="js/annotation.js"></script>
<!--[if lt IE 7]>
  <script src="http://ie7-js.googlecode.com/svn/version/2.1(beta4)/IE9.js">IE7_PNG_SUFFIX = ".png";</script>
<![endif]-->

  <script type="text/javascript">

    // The iipsrv server path (/fcgi-bin/iipsrv.fcgi by default)
    var server = '/fcgi-bin/iipsrv.fcgi';

    // The *full* image path on the server. This path does *not* need to be in the web
    // server root directory. On Windows, use Unix style forward slash paths without
    // the "c:" prefix
	var imglocation=window.location.search;
    if (imglocation.substring(0,1)=='?'){
    imglocation=imglocation.substring(1); }
    console.log(imglocation);

    // The *full* image path on the server. This path does *not* need to be in the web
    // server root directory.
    var images = imglocation;

    // Copyright or information message
    var credit = "<i>Portrait d'une femme Ã  sa toilette</i>&copy; C2RMF";
    // Create our viewer object
    // See documentation for more details of options
    var iipmooviewer = new IIPMooViewer( "targetframe", {
		image: images,
		server: server,
		credit: credit, 
		scale: 18.0
    });
    var annot = new Array();
    annot.push( {annotid:1,annotx:0.5,annoty:0.5,annotdetail:[{annotType:"rect",x: 0.38, y: 0.28, w: 0.14, h: 0.06,color:"#FF0000", text: "rect text"},{annotType:"circle",x: 0.54, y: 0.5, r:0.02, color:"blue",text: "sometext"},{annotType:"polygon",points:"0.5,0.64 0.54,0.45 0.58,0.64",color:"green",text:"polygon text"},{annotType:"ellipse",cx:0.48,cy:0.45,rx:0.02,ry:0.03,color:"yellow",text:"somemore text"}]});
    annot.push( {annotid:2,annotx:0.1,annoty:0.1,annotdetail:[{annotType:"rect",x: 0.1, y: 0.1, w: 0.01, h: 0.01,color:"red", text: "hoho"},{annotType:"circle",x: 0.12, y: 0.14, r:0.02, color:"blue",text: "haha"},{annotType:"polygon",points:"0.14,0.24 0.16,0.20 0.18,0.28",color:"yellow",text:"hehe"},{annotType:"ellipse",cx:0.20,cy:0.23,rx:0.02,ry:0.03,color:"blue",text:"hihi"}]});
    iipmooviewer.annotations=annot;
 </script>
 </head>

 <body>
   <div id="targetframe" style="width:100%;height:100%;position:absolute"></div>
   <div id="annotlayer"></div>
   <div id="menu-container" style="width:10%;height:10%;position:absolute;top:10%;left:2%;z-index:2">
   <ul id="drop_down_menu">
		<li class="menu">Annotation Controler
			<ul class="links">
				<li><a id="create">Create New Annotation</a></li>
				<li><a id="edit">Edit Existed Annotation</a></li>
				<li><a id="show">Show/hide Annotation</a></li>
			</ul>
		</li>

		<li class="menu" id="choosemenu">Choose An Annotation
			<ul id="chooselink" class="links">
			</ul>
		</li>

   </ul>
   </div>
   <div id="tiplayer" style="position:absolute;top:80%;left:40%;z-index:2">
   </div>
   <div id="editlayer" style="position:absolute;top:80%;left:40%;z-index:2">
   </div>
   <script type="text/javascript">
	$("show").addEvent('click',function(){  
						if($("annotlayer").style.visibility=='hidden')
		                                $("annotlayer").set({styles:{visibility:'visible'}});
						else 
						{$("annotlayer").set({styles:{visibility:'hidden'}});}
		                              });
       $("edit").addEvent('click',function(){  
						var newlink=$("chooselink");
						newlink.erase('html');
						for (var i=0;i<annot.length;i++)
                                               {   var newedit=new Element('li',
							{	id:'li_'+i,
								html:'<a> Edit Annotation '+i+'</a>',
								events:{click:function(){
								highlightAnnotation(iipmooviewer,annot,this.id);
								editAnnotation(iipmooviewer,annot,this.id);
								$("annotlayer").set({styles:{visibility:'visible'}});}}
							});
						   newedit.inject(newlink);
                                               }
                                               var canceledit=new Element('li',
							{	
								html:'<a> Cancel</a>',
								events:{click:function(){
								$("choosemenu").set({styles:{visibility:"hidden"}});
								if($("annotlayer").style.visibility=='visible')
								{ showSVGAnnotations(iipmooviewer,annot);
								$("annotlayer").set({styles:{visibility:'visible'}});}
								else 
								$("annotlayer").set({styles:{visibility:'hidden'}});}}
							});
                                               canceledit.inject(newlink);
					       $("choosemenu").set({styles:{visibility:"visible"}});
					    });									   
	window.addEvent('domready', function(){
		$('drop_down_menu').getElements('li.menu').each( function( elem ){
			var list = elem.getElement('ul.links');
			var myFx = new Fx.Slide(list).hide();
			elem.addEvents({
				'mouseenter' : function(){
					myFx.cancel();
					myFx.slideIn();
				},
				'mouseleave' : function(){
					myFx.cancel();
					myFx.slideOut();
				}
			});
		});
		$("choosemenu").set({styles:{visibility:"hidden"}});
	});
    $("annotlayer").addEvent('click',function(event){
     /* var pageCoords = "( " + event.pageX + ", " + event.pageY + " )";
      var clientCoords = "( " + event.clientX + ", " + event.clientY + " )";*/
      console.log(event.page);
      console.log(event.client);
    });
  </script>
 </body>
</html>
